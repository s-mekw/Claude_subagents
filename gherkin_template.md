# Gherkin形式テストシナリオ記述テンプレート

## 基本構造

```gherkin
Feature: [機能名]
  As a [ステークホルダー/ユーザーの役割]
  I want to [実現したい機能や動作]
  So that [ビジネス価値/目的/理由]

  Background:
    Given [全シナリオ共通の前提条件1]
    And [全シナリオ共通の前提条件2]
    And [全シナリオ共通の前提条件3]

  @[タグ1] @[タグ2]
  Scenario: [シナリオの説明]
    Given [初期状態/前提条件]
    When [ユーザーアクション1]
    And [ユーザーアクション2]
    Then [期待される結果1]
    And [期待される結果2]
    
    When [次のステップのアクション]
    And [追加のアクション]
    Then [次の期待結果]
    And [追加の期待結果]
```

## 要素の説明

### Feature（機能）
- テスト対象となる機能の名前と概要
- ユーザーストーリー形式で記述：
  - **As a**: 誰として（ユーザーの役割や立場）
  - **I want to**: 何をしたいか（実現したい機能）
  - **So that**: なぜ必要か（ビジネス価値や目的）

### Background（背景）
- 全てのシナリオで共通する前提条件
- データの初期設定や環境の準備

### Scenario（シナリオ）
- 具体的なテストケース
- エンドツーエンドの流れを記述

### ステップキーワード
- **Given**: 初期状態・前提条件
- **When**: ユーザーが実行するアクション
- **Then**: 期待される結果・検証項目
- **And**: 複数のステップを連結
- **But**: 否定的な条件や例外を記述（必要に応じて）

### タグ
- `@smoke`: スモークテスト（基本機能の動作確認）
- `@critical`: 重要度の高いテスト（ビジネスクリティカル）
- `@regression`: リグレッションテスト（既存機能の退行確認）
- `@security`: セキュリティ関連テスト
- `@performance`: パフォーマンステスト
- `@usability`: ユーザビリティテスト
- `@edge-case`: エッジケース・異常系テスト
- `@accessibility`: アクセシビリティテスト
- `@notification`: 通知・メール送信テスト
- `@error-handling`: エラーハンドリングテスト
- その他、プロジェクトに応じたカスタムタグ

## 記述のベストプラクティス

1. **ビジネス言語を使用**
   - 技術的な実装詳細ではなく、ビジネス観点で記述
   - 非技術者でも理解できる表現を使用

2. **具体的な値を含める**
   - テストデータは具体的に記述（例：`"test.user@example.com"`）
   - 期待値は明確に定義（例：`"123456"`）

3. **独立性を保つ**
   - 各シナリオは他のシナリオに依存しない
   - 単独で実行可能な状態を維持

4. **1シナリオ1機能**
   - 1つのシナリオで複数の機能をテストしない
   - フローが長い場合は適切に分割

5. **検証可能な記述**
   - 各ステップは自動化可能で検証可能な内容にする
   - 曖昧な表現を避ける

6. **QAエンジニアの多角的観点を網羅**
   - **セキュリティ観点**
     - 試行回数制限とアカウントロック機能
     - 不正アクセス防止（SQLインジェクション、XSS等）
     - データ漏洩防止と暗号化
     - セッション管理とタイムアウト
   - **ユーザビリティ観点**
     - 入力フィールドの操作性（自動フォーカス、入力制限）
     - エラーメッセージの明確性
     - ガイダンスとヘルプの適切な表示
     - 操作の直感性と学習曲線
   - **パフォーマンス観点**
     - レスポンス時間（3秒ルール）
     - 同時アクセス時の動作
     - 大量データ処理時の挙動
   - **エラーハンドリング**
     - 期限切れデータ（トークン、セッション等）
     - 使用済みデータの再利用防止
     - ネットワークエラー時の動作
     - 予期しない入力への対応
   - **アクセシビリティ観点**
     - スクリーンリーダー対応
     - キーボード操作のみでの完結
     - 適切なARIA属性の設定

7. **テストの体系化**
   - **体系的なタグ付与により、テストの重要度や目的を明確化**
     - 優先度タグ（@critical, @high, @medium, @low）
     - テストタイプタグ（@functional, @non-functional）
     - 実行タイミングタグ（@daily, @weekly, @release）
   - **タグの組み合わせによる効率的なテスト実行**
     - 例：`@smoke @critical`で最重要な基本機能テストを抽出
     - 例：`@security @regression`でセキュリティ回帰テストを実行

8. **ユーザー体験への配慮**
   - **機能仕様書に現れにくいUX要素のテスト**
     - 初回利用時のオンボーディング体験
     - エラー発生時のリカバリー手順の明確性
     - 待機時間中の適切なフィードバック（ローディング表示等）
   - **実際のユーザー行動パターンの考慮**
     - よくある誤操作とその対応
     - 複数タブ/ウィンドウでの同時操作
     - ブラウザの戻る/進むボタンの使用
   - **エッジケースとコーナーケース**
     - 境界値でのテスト
     - 異常な操作順序でのテスト
     - システム限界値でのテスト

## 実例

```gherkin
Feature: ユーザー認証機能
  As a 登録済みユーザー
  I want to メールアドレスとパスワードでログインできる
  So that 自分のアカウントにアクセスして個人情報を管理できる

  Background:
    Given ユーザー "user@example.com" が登録済みである
    And パスワードは "Password123!" である

  @smoke @authentication
  Scenario: 正常なログイン
    Given ログインページを開いている
    When メールアドレス "user@example.com" を入力する
    And パスワード "Password123!" を入力する
    And ログインボタンをクリックする
    Then ダッシュボード画面が表示される
    And ユーザー名 "user@example.com" が画面右上に表示される

  @authentication @error-handling
  Scenario: 不正なパスワードでのログイン失敗
    Given ログインページを開いている
    When メールアドレス "user@example.com" を入力する
    And パスワード "WrongPassword" を入力する
    And ログインボタンをクリックする
    Then エラーメッセージ "メールアドレスまたはパスワードが正しくありません" が表示される
    And ログインページに留まる
```

このテンプレートを使用することで、QAエージェントやテスト自動化エンジニアが一貫性のある、理解しやすいテストシナリオを作成できます。